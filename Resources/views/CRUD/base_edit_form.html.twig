{#

This file is part of the Rz package.

(c) mell m. zamora <me@rmzamora.com>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}

{% block form_orientation_type %}{% endblock form_orientation_type %}

{% block form_basic %}
    {% spaceless %}
    <form class="rz-form{{ block('form_orientation_type') }}"
          action="{{ admin.generateUrl(url, {'id': admin.id(object), 'uniqid': admin.uniqid, 'subclass': app.request.get('subclass')}) }}"
            {{ form_enctype(form) }}
          method="POST">
        {% if form.vars.errors|length > 0 %}
            <div class="rz-form-alert-block">
                <div class="alert alert-block alert-error sonata-ba-form-error">
                    <a class="close" data-dismiss="alert"><i class="icon-remove-sign"></i></a>
                    {{ form_errors(form) }}
                </div>
            </div>
        {% endif %}
        <div class="widget-box">
            <div class="widget-title">
                <span class="icon"><i class="icon-time"></i></span>
                <h5>
                    {% if admin.id(object) %}
                        {{ "title_edit"|trans({'%name%': admin.toString(object) }, 'SonataAdminBundle') }}
                    {% else %}
                        {{ "title_create"|trans({}, 'SonataAdminBundle') }}
                    {% endif %}
                </h5>
            </div>
            <div class="widget-content">
                {{ block('form_body') }}
            </div>
        </div>
        {{ form_rest(form) }}
        {{ block('form_actions') }}
    </form>
    {% endspaceless %}
{% endblock form_basic %}

{% block form_ajax %}
<form class="rz-form" action="{{ admin.generateUrl(url, {'id': admin.id(object), 'uniqid': admin.uniqid, 'subclass': app.request.get('subclass')}) }}"
        {{ form_enctype(form) }}
        method="POST">
    <div class="modal-header modal-primary">
        <button class="close" data-dismiss="modal"><i class="icon-remove-sign"></i></button>
        <h3>
            {% if admin.id(object) %}
                {{ "title_edit"|trans({'%name%': admin.toString(object) }, 'SonataAdminBundle') }}
            {% else %}
                {{ "title_create"|trans({}, 'SonataAdminBundle') }}
            {% endif %}
        </h3>
    </div>
    <div class="modal-body">
            {% if form.vars.errors|length > 0 %}
                <div class="rz-form-alert-block">
                    <div class="alert alert-block alert-error sonata-ba-form-error">
                        <a class="close" data-dismiss="alert"><i class="icon-remove-sign"></i></a>
                        {{ form_errors(form) }}
                    </div>
                </div>
            {% endif %}
            {{ block('form_body') }}
            {{ form_rest(form) }}
    </div>
    <div class="modal-footer">
        {{ block('form_actions') }}
    </div>
</form>
{% endblock form_ajax %}

{% block form_body %}
    {% block sonata_pre_fieldsets %}
        <div class="tabbable tabbable-bordered">
        <ul class="nav nav-tabs tabdrop">
            {% for name, form_group in admin.formgroups %}
                <li class="{% if loop.first %}active{% endif %}"><a href="#tab_{{ admin.uniqid }}_{{ name|sonata_slugify }}"{% if app.request.isXmlHttpRequest  %} class="admin-ajax-ignore-tabbable" {% endif %}data-toggle="tab">{{ admin.trans(name)|humanize }}</a></li>
            {% endfor %}
        </ul>
    {% endblock %}

    {% spaceless %}
        <div class="tab-content">
            {% for name, form_group in admin.formgroups %}
                <div class="tab-pane {% if loop.first %} active{% endif %}" id="tab_{{ admin.uniqid }}_{{ name|sonata_slugify }}">
                    <div class="row-fluid">
                        <div class="span12">
                            {% if form_group.description is defined %}
                                <div class="row-fluid {% if not loop.last %}formSep{% endif %}">
                                    <div class="control-group">
                                        <p>{{ form_group.description|raw }}</p>
                                    </div>
                                </div>
                            {% endif %}

                            {% for field_name in form_group.fields %}
                                {% if admin.formfielddescriptions[field_name] is defined %}
                                    <div class="row-fluid {% if not loop.last %}formSep{% endif %}">
                                        {{ form_row(form[field_name])}}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endspaceless %}
    {% block sonata_post_fieldsets %}
        </div>
    {% endblock %}
{% endblock form_body%}

{% block form_actions %}
    {% block formactions %}
        {% if not app.request.isxmlhttprequest %}
            <div class="well form-actions">
                {{ block('form_actions_buttons') }}
            </div>
        {% else %}
            {{ block('form_actions_buttons') }}
        {% endif %}
    {% endblock formactions %}
{% endblock form_actions%}

{% block form_actions_buttons %}
    {% if admin.supportsPreviewMode %}
        <button class="btn btn-info persist-preview sepH_a sepV_a" name="btn_preview" type="submit"><i class="icon-save"></i> {{ 'btn_preview'|trans({}, 'SonataAdminBundle') }}</button>
    {% endif %}
    {% if admin.id(object) %}
        <button type="submit" class="btn btn-primary sepH_a sepV_a" name="btn_update_and_edit"><i class="micon-pencil-2"></i> {{ 'btn_update_and_edit_again'|trans({}, 'SonataAdminBundle') }}</button>

        {% if admin.hasroute('list') %}
            <button type="submit" class="btn btn-primary sepH_a sepV_a" name="btn_update_and_list"><i class="micon-exit"></i> {{ 'btn_update_and_return_to_list'|trans({}, 'SonataAdminBundle') }}</button>
        {% endif %}

        {% if admin.hasroute('delete') and admin.isGranted('DELETE', object) %}
            <a class="btn btn-danger sepH_a sepV_a" href="{{ admin.generateObjectUrl('delete', object) }}"><i class="micon-remove"></i> {{ 'link_delete'|trans({}, 'SonataAdminBundle') }}</a>
        {% endif %}
    {% else %}
        <button class="btn btn-primary sepH_a sepV_a" type="submit" name="btn_create_and_edit"><i class="icon-save"></i> {{ 'btn_create_and_edit_again'|trans({}, 'SonataAdminBundle') }}</button>
        {% if not app.request.isxmlhttprequest %}
        <button class="btn btn-primary sepH_a sepV_a" type="submit" name="btn_create_and_create"><i class="micon-enter"></i> {{ 'btn_create_and_create_a_new_one'|trans({}, 'SonataAdminBundle') }}</button>
        <button class="btn btn-danger sepH_a sepV_a" type="button"><i class="micon-undo"></i> reset form</button>
        {% else %}
        <button class="btn btn-danger sepH_a sepV_a" type="button" data-dismiss="modal"><i class="micon-undo"></i> close</button>
        {% endif %}
    {% endif %}
    {% if admin.hasroute('list') and admin.isGranted('LIST') and not app.request.isxmlhttprequest %}
        <a class="btn btn-success  sonata-action-element sepH_a sepV_a" href="{{ admin.generateUrl('list') }}">
            <i class="icon-list"></i>
            {{ 'link_action_list'|trans({}, 'SonataAdminBundle') }}</a>
    {% endif %}
{% endblock form_actions_buttons %}

{% block form %}
    {% set url = admin.id(object) ? 'edit' : 'create' %}
    {% if not admin.hasRoute(url)%}
        <div>
            {{ "form_not_available"|trans({}, "SonataAdminBundle") }}
        </div>
    {% else %}
        {% if app.request.isxmlhttprequest %}
            {{ block('form_ajax') }}
        {% else %}
            {{ block('form_basic') }}
        {% endif %}
    {% endif%}
{% endblock %}
